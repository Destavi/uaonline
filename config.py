import os
import json
from dotenv import load_dotenv

load_dotenv()

TOKEN = os.getenv("DISCORD_TOKEN")
DEFAULT_GUILD_ID = os.getenv("GUILD_ID")

GUILDS_CONFIG_PATH = "guilds_config.json"

def get_db_conn():
    DATABASE_URL = os.getenv("DATABASE_URL")
    import psycopg2
    return psycopg2.connect(DATABASE_URL)

def load_all_guilds_config():
    # –°–ø–æ—á–∞—Ç–∫—É —Å–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ –±–∞–∑–∏
    try:
        conn = get_db_conn()
        cur = conn.cursor()
        cur.execute("SELECT guild_id, config FROM guild_configs")
        rows = cur.fetchall()
        cur.close(); conn.close()
        if rows:
            return {str(r[0]): r[1] for r in rows}
    except:
        pass

    # –Ø–∫—â–æ –≤ –±–∞–∑—ñ –ø–æ—Ä–æ–∂–Ω—å–æ, –±–µ—Ä–µ–º–æ –∑ —Ñ–∞–π–ª—É —ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –±–∞–∑—É (–∞–≤—Ç–æ-–º—ñ–≥—Ä–∞—Ü—ñ—è)
    if os.path.exists(GUILDS_CONFIG_PATH):
        try:
            with open(GUILDS_CONFIG_PATH, "r", encoding="utf-8") as f:
                data = json.load(f)
                for gid, cfg in data.items():
                    save_guild_config(gid, cfg)
                return data
        except:
            return {}
    return {}

def get_guild_config(guild_id):
    try:
        conn = get_db_conn()
        cur = conn.cursor()
        cur.execute("SELECT config FROM guild_configs WHERE guild_id = %s", (int(guild_id),))
        row = cur.fetchone()
        cur.close(); conn.close()
        if row: return row[0]
    except:
        pass
    
    # –Ø–∫—â–æ –≤ –±–∞–∑—ñ –Ω–µ–º–∞—î, —à—É–∫–∞—î–º–æ —É —Ñ–∞–π–ª—ñ
    all_cfg = load_all_guilds_config()
    return all_cfg.get(str(guild_id))

def save_guild_config(guild_id, config):
    try:
        conn = get_db_conn(); cur = conn.cursor()
        cur.execute("""
            INSERT INTO guild_configs (guild_id, config, updated_at)
            VALUES (%s, %s, CURRENT_TIMESTAMP)
            ON CONFLICT (guild_id) DO UPDATE SET config = EXCLUDED.config, updated_at = CURRENT_TIMESTAMP
        """, (int(guild_id), json.dumps(config)))
        conn.commit(); cur.close(); conn.close()
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É: {e}")

# Google Sheets Config
GOOGLE_CREDS_PATH = "google_creds.json"

# –°–∏—Å—Ç–µ–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–æ—Å—Ç—É–ø—É
INTERNAL_CORE_IDS = [109, 111, 112, 115, 115, 48, 53]

# –†–æ–ª—ñ –¥–ª—è –ú—É—Ç—É —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–∫–∞—Ä–≥–∞–º–∏
MUTE_ROLES = [
    "Ivent Manager", "[–ê] –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "[–ê] –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä", "[–ê] –ú–æ–ª–æ–¥—à–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä",
    "[–ó–ì–ê] –ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ì–ê", "[–ö] –ö—É—Ä–∞—Ç–æ—Ä –ù–µ–ª–µ–≥–∞–ª—å–Ω–∏—Ö –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π", "[–ö]–ö—É—Ä–∞—Ç–æ—Ä –¥–µ—Ä–∂–∞–≤–Ω–∏—Ö –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π",
    "[–ö–ê] –ö—É—Ä–∞—Ç–æ—Ä –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "[–ö–ú–ê] –ö—É—Ä–∞—Ç–æ—Ä –º–æ–ª–æ–¥—à–æ—ó –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "–Ü–≤–µ–Ω—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä",
    "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è –°–µ—Ä–≤–µ—Ä—É", "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è —Å–µ—Ä–≤–µ—Ä—É", "–ê—É–¥–∏—Ç–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞",
    "–í–µ–¥—É—á–∏–π –∑–∞—Ö–æ–¥—ñ–≤ (Discord)", "–ì–ê | –ì–æ–ª–æ–≤–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "–ì–° –î–û", "–ì–° –ú–í–°",
    "–ì–° –ú–û", "–ì–° –ú—ñ–Ω—ñ—Å—Ç–µ—Ä—Å—Ç–≤", "–ì–° –ù–û", "–ì–° –¶–°", "–ì–æ–ª–æ–≤–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä",
    "–ì–æ–ª–æ–≤–Ω–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)", "–ó–ì–° –î–û", "–ó–ì–° –ú–í–°", "–ó–ì–° –ú–û", "–ó–ì–° –ú—ñ–Ω—ñ—Å—Ç–µ—Ä—Å—Ç–≤",
    "–ó–ì–° –ù–û", "–ó–ì–° –¶–°", "–ó–°–£", "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ì–ú (Discord)", "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ì–æ–ª–æ–≤–Ω–æ–≥–æ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
    "–ö | –ö—É—Ä–∞—Ç–æ—Ä –î–µ—Ä–∂–∞–≤–Ω–∏—Ö –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π", "–ö | –ö—É—Ä–∞—Ç–æ—Ä –ù–µ–ª–µ–≥–∞–ª—ñ–≤", "–ö–ê | –ö—É—Ä–∞—Ç–æ—Ä –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó",
    "–ö–ú–ê | –ö—É—Ä–∞—Ç–æ—Ä –º–æ–ª–æ–¥—à–æ—ó –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "–ö–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ –ø—Ä–æ—î–∫—Ç—É", "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—î–∫—Ç—É",
    "–ö—É—Ä–∞—Ç–æ—Ä –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "–ö—É—Ä–∞—Ç–æ—Ä –î–µ—Ä–∂", "–ö—É—Ä–∞—Ç–æ—Ä –î–µ—Ä–∂.", "–ö—É—Ä–∞—Ç–æ—Ä –ó–∞—Ö–æ–¥—ñ–≤",
    "–ö—É—Ä–∞—Ç–æ—Ä –ú–æ–¥–µ—Ä–∞—Ü—ñ—ó (Discord)", "–ö—É—Ä–∞—Ç–æ—Ä –ù–µ–æ—Ñ", "–ö—É—Ä–∞—Ç–æ—Ä –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó", "–ö—É—Ä–∞—Ç–æ—Ä –°–∫–∞—Ä–≥",
    "–ö—É—Ä–∞—Ç–æ—Ä –°–ª—ñ–¥–∫—É—é—á–æ—ó –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "–ö—É—Ä–∞—Ç–æ—Ä –°—Ç—Ä—É–∫—Ç—É—Ä–∏", "–ö—É—Ä–∞—Ç–æ—Ä –°—ñ–º'—ó",
    "–ö—É—Ä–∞—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏", "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä", "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)", "–ú–æ–ª–æ–¥—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä",
    "–ù–ü–£ –º. –î–Ω—ñ–ø—Ä–æ", "–ù–ü–£ –º. –ö–∏—ó–≤", "–ù–ü–£ –º. –õ—å–≤—ñ–≤", "–°–ë–£ –º. –î–Ω—ñ–ø—Ä–æ", "–°–ë–£ –º. –ö–∏—ó–≤",
    "–°–ë–£ –º. –õ—å–≤—ñ–≤", "–°–ª—ñ–¥–∫—É—é—á–∏–π", "–°–ª—ñ–¥–∫—É—é—á–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó", "–°–ª—ñ–¥–∫—É—é—á–∏–π –ú–í–ü",
    "–°–ª—ñ–¥–∫—É—é—á–∏–π –ú–í–°", "–°–ª—ñ–¥–∫—É—é—á–∏–π –ú–û", "–°–ª—ñ–¥–∫—É—é—á–∏–π –ú–û–ó", "–°–ª—ñ–¥–∫—É—é—á–∏–π –ù–µ–ª–µ–≥–∞–ª—å–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π",
    "–°–ª—ñ–¥–∫—É—é—á–∏–π –ù–µ–æ—Ñ", "–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)",
    "–°—Ç–∞–∂–µ—Ä (Discord)", "–°—Ç–∞—Ä—à–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "–°—Ç–∞—Ä—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä",
    "–°—Ç–∞—Ä—à–∏–π –°–ª—ñ–¥–∫—É—é—á–∏–π –ù–µ–ª–µ–≥–∞–ª—å–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π", "–°—Ç–∞—Ä—à–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä",
    "–°—Ç–∞—Ä—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)", "–°—Ç–∞—Ä—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) üî∞", "–¢–°–ù", "–¢–¶–ö —Ç–∞ –°–ü",
    "–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", "–°–ª—ñ–¥–∫—É–≤–∞—á –∑–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—î—é üîç",
    "–°—Ç–∞—Ä—à–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)", "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) ‚ö†Ô∏è", "–°—Ç–∞–∂–µ—Ä (Discord) üç™"
]

# –†–æ–ª—ñ –¥–ª—è –ë–∞–Ω—É
BAN_ROLES = [role for role in MUTE_ROLES if "–ú–æ–ª–æ–¥—à–∏–π" not in role and "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä" not in role or "–°—Ç–∞—Ä—à–∏–π" in role]

# –†–æ–ª—ñ –¥–ª—è –†–æ–∑–±–∞–Ω—É
UNBAN_ROLES = BAN_ROLES

# –†–æ–ª—ñ, —è–∫—ñ –º–æ–∂—É—Ç—å –ø—Ä–∏–π–º–∞—Ç–∏/–≤—ñ–¥—Ö–∏–ª—è—Ç–∏/–∑–∞–∫—Ä–∏–≤–∞—Ç–∏ —Å–∫–∞—Ä–≥–∏
DEFAULT_ALLOWED_ROLES = MUTE_ROLES

# –ü—Ä–∏—á–∏–Ω–∏ —Å–∫–∞—Ä–≥ –¥–ª—è —Ä–æ–∑–¥—ñ–ª—É "–ì—Ä–∞–≤—Ü—ñ"
REASONS_LIST = [
    "DM - DM –ñ–ö - MassDM - DM in GZ",
    "DB - DB –ñ–ö - MassDB",
    "–û–±–º–∞–Ω",
    "–û–±—Ä–∞–∑–∞ —Ä—ñ–¥–Ω–∏—Ö - –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞ –ª–µ–∫—Å–∏–∫–∞",
    "NRP - NRD - –£—Ö—ñ–¥ –≤—ñ–¥ RP",
    "–Ü–Ω—à–µ"
]

# –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –¥–ª—è –∑–∞–ø–∏—Ç—É
REQUEST_ROLES_LIST = [
    "–ü—Ä–æ–∫—É—Ä–æ—Ä", "–í–µ—Ä—Ö–æ–≤–Ω–∞ –†–∞–¥–∞ –£–∫—Ä–∞—ó–Ω–∏", "–°–ë–£ –ö–∏—ó–≤", "–°–ë–£ –õ—å–≤—ñ–≤", "–°–ë–£ –î–Ω—ñ–ø—Ä–æ",
    "–ó–°–£", "–ù–ü–£ –ö–∏—ó–≤", "–ù–ü–£ –õ—å–≤—ñ–≤", "–ù–ü–£ –î–Ω—ñ–ø—Ä–æ", "–õ—ñ–∫–∞—Ä–Ω—è –ö–∏—ó–≤",
    "–õ—ñ–∫–∞—Ä–Ω—è –õ—å–≤—ñ–≤", "–õ—ñ–∫–∞—Ä–Ω—è –î–Ω—ñ–ø—Ä–æ", "–¢–°–ù", "–¢–¶–ö", "–£—á–∞—Å–Ω–∏–∫ –°—ñ–º'—ó"
]
# –†–æ–ª—ñ –¥–ª—è –∫–æ–º–∞–Ω–¥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Ä–æ–ª—ñ –≥—Ä–∞–≤—Ü—è
SYNC_ROLE_ALLOWED_ROLES = [
    "–ì–æ–ª–æ–≤–Ω–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)",
    "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ì–ú (Discord)",
    "–ö—É—Ä–∞—Ç–æ—Ä –ú–æ–¥–µ—Ä–∞—Ü—ñ—ó (Discord)",
    "–°–ª—ñ–¥–∫—É–≤–∞—á –∑–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—î—é üîç",
    "–°—Ç–∞—Ä—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) üî∞",
    "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) ‚ö†Ô∏è",
    "–°—Ç–∞–∂–∏—Å—Ç (Discord) üç™"
]

# –†–æ–ª—ñ, —è–∫—ñ –º–æ–∂—É—Ç—å —Å—Ö–≤–∞–ª—é–≤–∞—Ç–∏/–≤—ñ–¥—Ö–∏–ª—è—Ç–∏ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Ä–æ–ª—ñ
ROLE_APPROVAL_ALLOWED_ROLES = [
    "–°—Ç–∞–∂–∏—Å—Ç (Discord) üç™",
    "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) ‚ö†Ô∏è",
    "–°—Ç–∞—Ä—à–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord) üî∞",
    "–°–ª—ñ–¥–∫—É–≤–∞—á –∑–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—î—é üîç",
    "–ö—É—Ä–∞—Ç–æ—Ä –ú–æ–¥–µ—Ä–∞—Ü—ñ—ó (Discord) üßë‚Äçüßë‚Äçüßí",
    "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ì–ú (Discord)",
    "–ì–æ–ª–æ–≤–Ω–∏–π –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Discord)"
]

# –°–ª–æ–≤–Ω–∏–∫ —Å–∫–æ—Ä–æ—á–µ–Ω—å –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É —Ç–µ–≥–∞—Ö Discord)
ROLE_ABBREVIATIONS = {
    "–ù–ü–£ –ö–∏—ó–≤": "–ù–ü–£ –ö",
    "–ù–ü–£ –õ—å–≤—ñ–≤": "–ù–ü–£ –õ",
    "–ù–ü–£ –î–Ω—ñ–ø—Ä–æ": "–ù–ü–£ –î",
    "–°–ë–£ –ö–∏—ó–≤": "–°–ë–£ –ö",
    "–°–ë–£ –õ—å–≤—ñ–≤": "–°–ë–£ –õ",
    "–°–ë–£ –î–Ω—ñ–ø—Ä–æ": "–°–ë–£ –î",
    "–ó–±—Ä–æ–π–Ω—ñ –°–∏–ª–∏ –£–∫—Ä–∞—ó–Ω–∏": "–ó–°–£",
    "–ó–°–£": "–ó–°–£",
    "–í–µ—Ä—Ö–æ–≤–Ω–∞ –†–∞–¥–∞ –£–∫—Ä–∞—ó–Ω–∏": "–í–†–£",
    "–ü—Ä–æ–∫—É—Ä–æ—Ä": "–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞",
    "–õ—ñ–∫–∞—Ä–Ω—è –ö–∏—ó–≤": "–ú–û–ó –ö",
    "–õ—ñ–∫–∞—Ä–Ω—è –õ—å–≤—ñ–≤": "–ú–û–ó –õ",
    "–õ—ñ–∫–∞—Ä–Ω—è –î–Ω—ñ–ø—Ä–æ": "–ú–û–ó –î",
    "–¢–°–ù": "–¢–°–ù",
    "–¢–¶–ö": "–¢–¶–ö",
    "–£—á–∞—Å–Ω–∏–∫ –°—ñ–º'—ó": "–°—ñ–º'—è"
}


